<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--

     Copyright 2014-2016 CyberVision, Inc.

     Licensed under the Apache License, Version 2.0 (the "License");
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an "AS IS" BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.

-->

<projectsConfig
        xmlns="http://www.kaaproject.org"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.kaaproject.org ../../common/src/main/resources/demo/projects/demo_projects_schema.xsd">
    <project id="profiling_demo_java">
        <name>Endpoint Profiling and Grouping Java demo</name>
        <description>Endpoint profiling and grouping application that demonstrates Kaa’s server profiling, grouping, and configuration management capabilities</description>
        <details>
            <![CDATA[
This Endpoint profiling and grouping app demonstrates the use of server-side endpoint profile and device management features. It allows to activate/deactivate device based on the endpoint ID and work with endpoint credentials using Kaa REST API.

<h2>Installation</h2>
Download the jar file to your desktop by clicking the "Binary" button on the left. Make sure that you have Java runtime installed. Application can run in three modes: client, admin and developer. The mode is specified by command line arguments.<br/>
To run in the "admin" mode, use the following command in the console:
<pre>
$ java -jar ProfilingDemo.jar admin [ipAddress] [port]
Example:
$ java -jar ProfilingDemo.jar admin localhost 8080
</pre>
Where ipAddress is the address of the Kaa node, where the administrative REST API is deployed.<br/><br/>
To run in the "client" mode, use the following command in the console:
<pre>
$ java -jar ProfilingDemo.jar client
</pre>
To run in the "developer" mode, use the following command in the console:
<pre>
$ java -jar ProfilingDemo.jar developer [ipAddress] [port]
</pre>
<h2>Playing around</h2>
Make sure that the Kaa Sandbox is up and running.
"Profiling Demo" consists of the next modes:

1) In "admin" mode you will be able to do credentials provisioning (Device Management feature), revocation and registration. Before using "developer" or "client" mode, you need to create and register endpoint credentials via Kaa REST API.
Run app with the next command:
<pre>
$ java -jar ProfilingDemo.jar admin [kaa_hostname] 8080
</pre>
Then choose the first menu item by typing "1" and pressing "Enter".
Exit from application by typing "3" and pressing "Enter".
Now credentials was created and registered in Kaa. Corresponding "key.private" and "key.public" files are created.
Starting from now, you can use other modes.
2) In "developer" mode you will be able
to activate/deactivate any endpoint associated with Profiling app. Endpoint profiling are performed by updating server profile using REST API.<br/><br/>
"Profiling Demo" app in "client" mode creates and registers one Kaa endpoint (per application instance). In this mode app displays the current state of the endpoint (active or inactive). Once the profiling is performed via the "developer" application, your endpoint will be served with the new configuration data according to the server-side endpoint profile change.<br/>

<br/>

To understand better how this app works, you should navigate to the Kaa server administrative interface by clicking the "Administrative console" link at the top of your Sandbox window. Log in as a tenant developer (devuser / devuser123 by default), and go to the "Profiling demo" application. Select "Schemas"->"Server-side EP profile". The app uses one schema version, which contains one value: "active" (boolean). The Kaa server uses this value to filter endpoints by their profile contents. Server-side endpoint profiles can be updated either via Admin Console, or via the REST API (which is done by the "Profiling app" in the "admin" mode)<br/><br/>

Now open the "Configuration" schema under "Schemas" and select version 2 to see the structure of the configuration data. There is one value in the configuration schema: "active" (boolean). This value is what's actually sent to each endpoint by the server to specify the target endpoint state (active or inactive).<br/><br/>

Finally, it's time to see what determines the configuration data. Go to the "Endpoint groups" section. There are three endpoint groups available.<br/><br/>

The endpoints are put into either "Active device group" or "Inactive device group" depending on the "active" variable value in the server profile. See the corresponding profile filters in the group details window. Each endpoint group defines its own configuration (active or inactive) - and when the server-side profile for some EP is changed, the EP is moved from one group to another and this results in updated configuration being pushed by the server to the corresponding EP.<br/><br/>

Please note that all features of the <a href="http://docs.kaaproject.org/display/KAA/Administration+UI+guide">Administrative UI</a> are also supported via the <a href="http://docs.kaaproject.org/display/KAA/Admin+REST+API">REST API</a>.

<h2>What's next?</h2>

For more background on the Kaa endpoint profiling, grouping, and configuration management features, please refer to the <a href="http://docs.kaaproject.org/display/KAA/Programming+guide">programming guide</a> and <a href="http://docs.kaaproject.org/display/KAA/Design+reference">design reference</a> sections.
]]>
        </details>

        <!-- Specifies the source code language of Kaa endpoint SDK which is used by this project 
             (ex. JAVA, CPP, etc., to get list of all possible options
             see 'sdkLanguage' type in demo_projects_schema.xsd schema) -->

        <sdkLanguage>JAVA</sdkLanguage>

        <!-- Specifies the target runtime platforms according to the instructions from the project details section
             (ex. LINUX_X86, ANDROID, IOS, ESP8266, etc., to get list of all possible options
             see 'platform' type in demo_projects_schema.xsd schema) -->

        <platforms>LINUX_X86 WINDOWS_X86</platforms>
        <features>CONFIGURATION</features>
        <complexity>BASIC</complexity>
        <sourceArchive>java/profiling_demo.tar.gz</sourceArchive>
        <projectFolder>JProfilingDemo</projectFolder>
        <sdkLibDir>JProfilingDemo/lib</sdkLibDir>
        <destBinaryFile>JProfilingDemo/build/jar/ProfilingDemo.jar</destBinaryFile>
    </project>
    
    <project id="profiling_demo_objc">
        <name>Endpoint Profiling and Grouping Objective-C demo</name>
        <description>Endpoint profiling and grouping application that demonstrates Kaa’s server profiling, grouping, and configuration management capabilities based on Objective-C SDK</description>
        <details>
            <![CDATA[
<p>
	This sample application uses the <a href="http://kaaproject.github.io/kaa/docs/Glossary/#endpoint-profile-client-side-server-side">endpoint profiling</a> and <a href="http://kaaproject.github.io/kaa/docs/Glossary/#endpoint-group">grouping</a> features based on the <a href="http://kaaproject.github.io/kaa/docs/Glossary/#sdk-type" target="_blank">Kaa Objective-C SDK</a>.
	These features enable <a href="http://kaaproject.github.io/kaa/docs/Glossary/#kaa-client" target="_blank">Kaa client</a> to set the default configuration and receive configuration updates from <a href="http://kaaproject.github.io/kaa/docs/Glossary/#kaa-server" target="_blank">Kaa server</a> in compliance with profile and group settings.
</p>

<p>
	The sample application uses three API call methods:
	<ul>
		<li>
			<code>addConfigurationDelegate:</code> method calls every time the configuration is updated.
		</li>
		<li>
			<code>setConfigurationStorage:</code> method sets the configuration storage that will be used to persist configuration.
		</li>
		<li>
			<code>setProfileContainer:</code> method changes the data in the client-side endpoint profile.
		</li>
    </ul>
</p>

<h1>Launching</h1>

<p>
	Before launching the application, make sure you have the latest version of xCode and CocoaPods installed.
</p>

To launch this sample application on the Kaa Objective-C SDK:

<ol>
	<li>
		Prepare your Objective-C SDK environment.
		To do this, follow the instructions in <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Using-Kaa-endpoint-SDKs/Objective-C/" target="_blank">Using Kaa endpoint SDKs</a>.
	</li>
	<li>
		Click the <b>Source</b> button.
		A project source download window will open.
		Click <b>Ok</b> and download the .tar.gz file.
	</li>
	<li>
		Unpack the downloaded archive and run the following command from the directory containing the unpacked source files.
		
		<pre>
			sh build.sh compile
		</pre>
		
		The build script will extract the Kaa SDK, install dependencies with CocoaPods and build the SDK.
	</li>
	<li>
		Open the ProfilingDemo.xcodeproj and click the <b>Play</b> button.
		You should see the following console messages.
		
		<pre>
			2016-09-07 14:46:14.053 ProfilingDemo[26391:4700219] ProfilingDemo started
			2016-09-07 14:46:15.165 ProfilingDemo[26391:4700295] Kaa client started
			2016-09-07 14:46:15.166 ProfilingDemo[26391:4700295] Audio support enabled: yes, video support enabled: yes, vibro support enabled: yes
		</pre>
		
	</li>
</ol>

<h1>Troubleshooting</h1>

<h2>Running the build script returns an error message</h2>

<pre>
	[!] Invalid `Podfile` file: [!] Unsupported options `{:exclusive=>true}` for target `KaaTests`.
</pre>

<p>
	This error can occur when using newer than version 1.0 of Cocoapods.
</p>

Try the following:

<ol>
	<li>
		Run the following command from the ./libs/kaa-ep-sdk/ folder.
		
		<pre>
			vim Podfile
		</pre>
		
	</li>
	<li>
		Delete <b>:exclusive=>true</b>.
	</li>
	<li>
		Run this command.
		
		<pre>
			pod install
		</pre>
		
	</li>
</ol>

Now you can open the ProfilingDemo.xcodeproj file and run the build script.

<h2>Nothing happens after the "Build succeeded" message</h2>

Make sure that the build target is set to <b>ProfilingDemo</b>, not <b>Kaa</b>.

<p>
	For more information, see <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Debugging-and-troubleshooting/" target="_blank">Debugging and troubleshooting</a>.
</p>
            ]]>
        </details>
        <sdkLanguage>OBJC</sdkLanguage>
        <platforms>IOS</platforms>
        <features>CONFIGURATION</features>
        <complexity>BASIC</complexity>
        <bundleId>profiling_demos</bundleId>
        <sourceArchive>objc/profiling_demo.tar.gz</sourceArchive>
        <projectFolder>ObjCProfilingDemo</projectFolder>
        <sdkLibDir>ObjCProfilingDemo/libs</sdkLibDir>
        <destBinaryFile></destBinaryFile>
    </project>
    <bundle id="profiling_demos">
        <name>Profiling demos</name>
        <description>Kaa Profiling subsystem demo applications bundle</description>
        <details>
            <![CDATA[
<p>
	This application bundle demonstrates the features of Kaa <b>Grouping extension</b>.
	The Grouping extension works in conjunction with the <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Endpoint-profiles/">Profiling</a> and <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Configuration-management/">Configuration</a> extensions.
</p>
<p>
	This demonstration uses pager as an example device that can produce signals such as video, audio, and vibration.
</p>

<h1>Playing around</h1>

<h2>Endpoint profile schemas</h2>

This demo <a href="http://kaaproject.github.io/kaa/docs/Glossary/#kaa-application" target="_blank">application</a> contains 3 instances of <a href="http://kaaproject.github.io/kaa/docs/Glossary/#kaa-client" target="_blank">Kaa client</a>
Each client instance has its own unique client-side <a href="http://kaaproject.github.io/kaa/docs/Glossary/#endpoint-profile-client-side-server-side" target="_blank">endpoint (EP) profile</a>.
The profile data structure is defined in the EP profile schema.
The data values in the schema define which functions are supported by the endpoint device.
In this example, the device will support audio, video and vibration signals.

<p>
	For this purpose, the following client-side EP profile schema is used in the sample application.
	
	<pre>
		{
		  "type" : "record",
		  "name" : "PagerClientProfile",
		  "namespace" : "org.kaaproject.examples.pager",
		  "fields" : [ {
			"name" : "audioSupport",
			"type" : "boolean"
		  }, {
			"name" : "videoSupport",
			"type" : "boolean"
		  }, {
			"name" : "vibroSupport",
			"type" : "boolean"
		  } ],
		  "displayName" : "org.kaaproject.examples.pager.PagerClientProfile"
		}
	</pre>
	
</p>
<p>
	You can view and edit this schema using the <a href="http://kaaproject.github.io/kaa/docs/Glossary/#administration-ui" target="_blank">Administration UI</a>.
</p>

To do this:

<ol>
	<li>
		Click the <b>Administration UI</b> button, enter username <b>devuser</b> and password <b>devuser123</b>.
	</li>
	<li>
		Click the <b>Applications</b> arrow to unfold the list.
		Click <b>Profiling demo</b> > <b>Schemas</b> > <b>Client-side EP profile</b>.
		You will see the list of all client-side EP profile schemas stored for your application.
		
		<br />
		<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_0.png" />
		<br />
		<br />
		
	</li>
	<li>
		Select the <b>PagerClientProfile</b> schema by clicking on the corresponding row.
		The <b>Client-side EP profile schema details</b> page will open.
		
		<br />
		<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_1.png" />
		<br />
		<br />
		
		The <b>PagerClientProfile</b> schema is included in the Sandbox for demonstration purpose.
		You can create your own client-side EP profile schemas.
		To do this, use the <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Server-REST-APIs/#!/Profiling/saveProfileSchema" target="_blank">server REST API</a> or follow <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Endpoint-profiles/#setting-client-side-EP-profile-schema" target="_blank">these instructions</a>for Administration UI.
	</li>
</ol>

<p>
	The same data structure is used for the <b>server-side EP profile schema</b>.
	The following server-side EP profile schema is used for this sample application.

	<pre>
		{
		  "type" : "record",
		  "name" : "PagerServerProfile",
		  "namespace" : "org.kaaproject.examples.pager",
		  "fields" : [ {
			"name" : "audioSubscription",
			"type" : "boolean"
		  }, {
			"name" : "videoSubscription",
			"type" : "boolean"
		  }, {
			"name" : "vibroSubscription",
			"type" : "boolean"
		  } ],
		  "displayName" : "org.kaaproject.examples.pager.PagerServerProfile"
		}
	</pre>
</p>

<p>
	To view and edit this schema in the Administration UI, open the <b>Server-side EP profile</b> page under the <b>Schemas</b> section of your application and select the <b>PagerServerProfile</b> schema.
</p>

<p>
	To create your own server-side EP profile schemas, use the <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Server-REST-APIs/#!/Profiling/saveServerProfileSchema" target="_blank">server REST API</a> or follow <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Endpoint-profiles/#setting-server-side-EP-profile-schema" target="_blank">these instructions</a>for Administration UI.
</p>

<h2>Endpoint configuration schema</h2>

Each EP can receive a configuration that defines which functions to enable for the EP device.
The configuration data structure is defined in the <b>configuration schema</b>.
The following configuration schema is used for this sample application.
	
<pre>
	{
	  "type" : "record",
	  "name" : "PagerConfiguration",
	  "namespace" : "org.kaaproject.examples.pager",
	  "fields" : [ {
		"name" : "audioSubscriptionActive",
		"type" : "boolean",
		"by_default" : false
	  }, {
		"name" : "videoSubscriptionActive",
		"type" : "boolean",
		"by_default" : false
	  }, {
		"name" : "vibroSubscriptionActive",
		"type" : "boolean",
		"by_default" : true
	  } ],
	  "displayName" : "org.kaaproject.examples.pager.PagerConfiguration"
	}
</pre>

<p>
	To view and edit this schema in the Administration UI, open the <b>Configuration</b> page under the <b>Schemas</b> section of your application and select the <b>PagerConfiguration</b> schema.
</p>

<p>
	To create and edit your own server-side EP profile schemas, use the <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Server-REST-APIs/#!/Configuration/editConfiguration" target="_blank">server REST API</a> or follow <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Configuration-management/#updating-configuration-data" target="_blank">these instructions</a>for Administration UI.
</p>

<h2>Endpoint groups</h2>

Any endpoint can be a member of one or multiple <a href="http://kaaproject.github.io/kaa/docs/Glossary/#endpoint-group" target="_blank">groups</a>.
The configuration data is sent from <a href="http://kaaproject.github.io/kaa/docs/Glossary/#endpoint-group" target="_blank">Kaa server</a> to endpoint groups.
This means that the endpoints receive their configuration based on the group membership.
Every endpoint, once registered, automatically becomes a member of the default group <a href="http://kaaproject.github.io/kaa/docs/Glossary/#endpoint-group" target="_blank">All</a>.
This means that once you start your endpoint, it will receive the default configuration from the group <b>All</b>.

<p>
	For any group, you can change the entire configuration data or override a particular value.
	For more information, see <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Endpoint-groups/" target="_blank">Endpoint groups</a>.
</p>

<p>
	This sample application contains these four groups: <b>Audio and vibration</b>, <b>Vibration only</b>, <b>All signals enabled</b>, and <b>Disable vibration if audio and video are supported</b>.
	To view the list of endpoint groups, open the <b>Endpoint groups</b> page of the application.
	
	<br />
	<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_6.png" />
	<br />
	<br />
	
	Each of these groups has its own configuration that defines which functions the endpoint device will support.	
</p>

<p>
	To play around with the sample application, download the binaries/sources for the target platform and start the application.
	To do this, choose the target platform below and follow the instructions on the dedicated page.
</p>

<p>
	When you start this demo application, the following console messages will be displayed.
	
	<pre>
		016-08-08 13:20:28,272 [main] INFO  o.k.k.d.c.ConfigurationDemo - Profiling demo started
		2016-08-08 13:20:29,399 [pool-2-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - Vbm/biBNcKTNSplA5qaPkBhRyTU=
		2016-08-08 13:20:29,400 [pool-2-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: false, videoSupport: false, vibroSupport: true
		2016-08-08 13:20:29,401 [pool-2-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 0-th endpoint configuration: audio: false, video: false, vibration: true
		
		2016-08-08 13:20:30,096 [pool-8-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - HCSG8+xLPouhS8ffLSVKrK/ND/k=
		2016-08-08 13:20:30,097 [pool-8-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: true, videoSupport: false, vibroSupport: true
		2016-08-08 13:20:30,097 [pool-8-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 1-th endpoint configuration: audio: false, video: false, vibration: true
		
		2016-08-08 13:20:30,249 [pool-14-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - FbeamiaBVnuvCorEbw3mVjSD6NI=
		2016-08-08 13:20:30,249 [pool-14-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: true, videoSupport: true, vibroSupport: true
		2016-08-08 13:20:30,249 [pool-14-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 2-th endpoint configuration: audio: false, video: false, vibration: true
		
		2016-08-08 13:20:30,390 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 1-th endpoint had been updated.
		2016-08-08 13:20:30,390 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - HCSG8+xLPouhS8ffLSVKrK/ND/k=
		2016-08-08 13:20:30,390 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: true, videoSupport: false, vibroSupport: true
		2016-08-08 13:20:30,391 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 1-th endpoint configuration: audio: true, video: false, vibration: true
		
		2016-08-08 13:20:30,468 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 2-th endpoint had been updated.
		2016-08-08 13:20:30,469 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - FbeamiaBVnuvCorEbw3mVjSD6NI=
		2016-08-08 13:20:30,469 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: true, videoSupport: true, vibroSupport: true
		2016-08-08 13:20:30,469 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 2-th endpoint configuration: audio: true, video: true, vibration: true
		
		2016-08-08 13:20:33,248 [main] INFO  o.k.k.d.c.ConfigurationDemo - --= Press any key to exit =--
	</pre>
</p>

<p>
	As mentioned before, each of the three instances of Kaa client represents one endpoint.
	The messages above inform the user about the supported set of functions defined for each endpoint in the client-side profile.
	The first three message blocks inform about the default configuration received by the endpoints.
	The last two message blocks report about the configuration changes made by Kaa server to two of the three endpoints (explained in the <b>Endpoint configuration update</b> section below).
</p>
<p>
	All endpoints first received the same default configuration because they are members of the default group <i>all</i> and are not assigned to any other groups yet.
	In this example, the default configuration for each endpoint is to have audio and video support disabled and vibration support enabled.
</p>
<p>
	To change the default configuration of an endpoint, assign that endpoint to the group that has the needed configuration.
	To do this, you need to set the profile filter for that group so that the endpoint in question becomes the member of that group based on your profile filter settings.
</p>

<h2>Manage groups based on client-side profile filters</h2>

To manage profile filters for a group

<ol>
	<li>
		Open the <b>Endpoint groups</b> page of the application.
	</li>
	<li>
		Select the group by clicking the corresponding row in the list.
		The <b>Endpoint group details</b> page will open.
	
		<br />
		<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_7.png" />
		<br />
		<br />
	
		In the <b>Profile filters</b> section of the page, you can see the list of profile filters that define which endpoints belong to this group.
	</li>
	<li>
		Select the <b>Audio and vibration support</b> group created for this sample application.
		The <b>Profile filter details</b> page will open.
	
		<br />
		<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_8.png" />
		<br />
		<br />	
	
		The <b>Filter body</b> block contains the filter definition.
		</li>
</ol>
<p>
	As mentioned before, there are four groups defined for this sample application.
	Each group contains one filter that applies to the client-side EP profile.
	
	<pre>
		// "Audio and vibration"
		#cp.audioSupport == true && #cp.videoSupport == false && #cp.vibroSupport == true
		
		// "Vibration only"
		#cp.audioSupport == false && #cp.videoSupport == false && #cp.vibroSupport == true
		
		// "All signals enabled"
		#cp.audioSupport == true && #cp.videoSupport == true && #cp.vibroSupport == true
		
		// "Disable vibration if audio and video are supported"
		#cp.audioSupport == true && #cp.videoSupport == true && #cp.vibroSupport == true
	</pre>
</p>
<p>
	When you start your application, each EP sends its client-side profile data to Kaa server for registration.
	For more information about EP registration, see <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Endpoint-provisioning-and-registration/" target="_blank">Endpoint provisioning and registration</a>.
</p>
<p>
	Then Kaa server gets the list of the endpoint groups in the application and checks the group filters against the client and server side of the EP profiles.
	The check is done in the ascending order of the group weight, starting from the lowest weight group <b>All</b>.
	If the client-side and server-side of the EP profile matches the conditions of a group filter, the server assigns the endpoint to that group.
	As a result, the server applies the configuration of that group to the endpoint by merging the changes in the base and override schemas.
	<br />
	<br />
	For more information, see <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Configuration-management/" target="_blank">Configuration management</a>.
</p>

<h2>Endpoint configuration update</h2>

As shown in the <b>Endpoint groups</b> section above, when you start the application, the last two message blocks in the console will look like this.

<pre>
		2016-08-08 13:20:30,390 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 1-th endpoint had been updated.
		2016-08-08 13:20:30,390 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - HCSG8+xLPouhS8ffLSVKrK/ND/k=
		2016-08-08 13:20:30,390 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: true, videoSupport: false, vibroSupport: true
		2016-08-08 13:20:30,391 [pool-10-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 1-th endpoint configuration: audio: true, video: false, vibration: true
		
		2016-08-08 13:20:30,468 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 2-th endpoint had been updated.
		2016-08-08 13:20:30,469 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - FbeamiaBVnuvCorEbw3mVjSD6NI=
		2016-08-08 13:20:30,469 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: true, videoSupport: true, vibroSupport: true
		2016-08-08 13:20:30,469 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 2-th endpoint configuration: audio: true, video: true, vibration: true
</pre>

This means that the endpoints #1 and #2 were updated with new configuration because the server found profile filters that match the client-side profile data of these two endpoints.

<p>
	Client-side profile of the endpoint #1 matches the profile filter from the <b>Audio and vibration</b> group, therefore the configuration of this group is applied to this endpoint.
	In the same way, the endpoint #2 became a member of the <b>All signals enabled</b> group.
</p>
<p>
	The configuration of this group has the <code>audioSubscriptionActive</code> property overridden to <b>true</b>.
	Since the profile data of the endpoint does not match any other filter, its audio setting is overridden while other settings remain as per the default configuration.
	As a result, endpoint #1 can now produce audio and vibration signals.
</p>
<p>
	To view the the <b>Audio and vibration</b> group configuration, select this group on the <b>Endpoint groups</b> page and select the configuration from the <b>Configurations</b> section.

	<br />
	<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_10.png" />
	<br />
	<br />

	Select the check box of the base configuration property that you want to override.
	The base configuration is the one that has the same version in the group with the closest lower weight.
	In this example, it is the group <b>All</b>.
	See also <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Configuration-management/#base-schema" target="_blank">Base schema</a> and <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Configuration-management/#override-schema" target="_blank">Override schema</a>.
</p>
<p>
	Now let's change the configuration of the endpoint #2 one more time:
	
	<ol>
		<li>
			Open the <b>Disable vibration if audio and video are supported</b> endpoint group.
		</li>
		<li>
			Select the pre-configured filter in the <b>Profile filters</b> section.
		</li>
		<li>
			On the <b>Profile filter details</b> page, select the <b>Draft</b> tab and click the <b>Activate</b> button.
			
			<br />
			<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_11.png" />
			<br />
			<br />
			
		</li>
	</ol>
</p>
<p>
	The following console messages will be displayed.

	<pre>
		...
		2016-08-12 16:27:19,777 [pool-16-thread-1] INFO  o.k.k.d.c.ProfilingDemo - The configuration for the 2-th endpoint had been updated.
		2016-08-12 16:27:19,778 [pool-16-thread-1] INFO  o.k.k.d.c.ProfilingDemo - KeyHash   - FbeamiaBVnuvCorEbw3mVjSD6NI=
		2016-08-12 16:27:19,778 [pool-16-thread-1] INFO  o.k.k.d.c.ProfilingDemo - Client EP - audioSupport: true, videoSupport: true, vibroSupport: true
		2016-08-12 16:27:19,778 [pool-16-thread-1] INFO  o.k.k.d.c.ProfilingDemo - 2-th endpoint configuration: audio: true, video: true, vibration: false.
	</pre>

	This means that the endpoint #2 became a member of the <b>Disable vibration if audio and video are supported</b> group, and the configuration of this endpoint changed accordingly.
	Note that an endpoint can be assigned to groups only when the endpoint is online and has a connection to Kaa server.
	As mentioned above, the endpoint #2 was initially a member of the default group <b>All</b>, then became a member of the <b>All signals support</b>.
	When the endpoint #2 became a member of the <b>Disable vibration if audio and video are supported</b> group, the <code>vibroSubscriptionActive</code> parameter was overridden because this group has bigger weight and therefore higher priority.
	As a result, the endpoint #2 can now produce audio and video signals only.
</p>

<h2>Manage groups based on sever-side profile filters</h2>

Upon successful registration, every endpoint receives a default server-side profile from Kaa server.
If you add your own versions of the server-side EP profile schema, the server will apply the latest version.
In the default Server-side EP, as values of properties will be set default values for the type of specific schema property.
See also <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Key-platform-features/Endpoint-profiles/#setting-server-side-EP-profile-schema" target="_blank">Setting server-side EP profile schema</a>.

<p>
	For demonstration purpose, this demo application has a default server-side profile with all properties set to <b>false</b> and applied to all the three endpoints.
	
	<pre>
		{
		  "audioSubscription" : false,
		  "videoSubscription" : false,
		  "vibroSubscription" : false
		}
	</pre>
	
</p>
<p>
	Similar to applying profile filters to client-side EP profiles, you can also apply them to the server-side EP profile to create endpoint groups.
</p>
<p>
	For example, let's disable all types of signals for all endpoints.
</p>

To do this:

<ol>
	<li>
		Open the <b>Endpoint groups</b> page and create a <b>Disable all signals</b> group and set its <b>Weight</b> value to <b>100</b>.
		
		<br />
		<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_12.png" />
		<br />
		<br />
		
	</li>
	<li>
		Open the <b>Configuration</b> page and click <b>Add configuration</b>.
		Select the appropriate <b>Schema version</b> (version <b>2</b> in this case).
	</li>
	<li>
		In the <b>Draft</b> tab of the <b>Configuration details</b> page, edit the contents of the <b>Configuration body</b> block to look like this.
		
		<br />
		<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_13.png" />
		<br />
		<br />
		
		Make sure to select all three check boxes to override the corresponding base configuration properties.
	</li>
	<li>
		Click <b>Save</b> to save the configuration, then click <b>Activate</b> to apply this configuration to the group.
	</li>
</ol>

<p>
	Add a profile filter to the <b>Disable all signals</b>.
	
	To do this:
	<ol>
		<li>
			Open the <b>Endpoint group details</b> page and click <b>Add profile filter</b>.
		</li>
		<li>
			Copy and paste this line into the <b>Filter body</b> block.
		
			<pre>
				#sp.audioSubscription == false && #sp.videoSubscription == false && #sp.vibroSubscription == false
			</pre>	
		
		</li>
		<li>
			Click <b>Save</b>, then click <b>Activate</b>.
		</li>
	</ol>
	
	The console will display the following messages.
	
	<pre>
		...

		2016-08-15 13:04:59,621 [pool-9-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 1-th endpoint had been updated.
		2016-08-15 13:04:59,621 [pool-9-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - HCSG8+xLPouhS8ffLSVKrK/ND/k=
		2016-08-15 13:04:59,621 [pool-9-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 1-th endpoint configuration: audio: false, video: false, vibration: false.
		
		2016-08-15 13:04:59,625 [pool-4-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 0-th endpoint had been updated.
		2016-08-15 13:04:59,626 [pool-4-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - Vbm/biBNcKTNSplA5qaPkBhRyTU=
		2016-08-15 13:04:59,629 [pool-4-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 0-th endpoint configuration: audio: false, video: false, vibration: false.
		
		2016-08-15 13:04:59,694 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 2-th endpoint had been updated.
		2016-08-15 13:04:59,694 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - FbeamiaBVnuvCorEbw3mVjSD6NI=
		2016-08-15 13:04:59,694 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 2-th endpoint configuration: audio: false, video: false, vibration: false.
	</pre>
	
	All types of signals are now disabled for all the three endpoints.
</p>
<p>
	Let's now override one configuration property so that the server-side EP data affects enabling or disabling the signal types for the endpoints.
</p>
<p>
	Create a group named <b>Enable audio if supported by device</b> and set its weight to <b>110</b>.
	Apply the following filter.
	
	<pre>
		#cp.audioSupport == true && #sp.audioSubscription == true
	</pre>
	
	Apply the following configuration.
	
	<pre>
		{
		  "audioSubscriptionActive" : true,
		  "videoSubscriptionActive" : unchanged,
		  "vibroSubscriptionActive" : unchanged
		}
	</pre>
	
	Note that <b>unchanged</b> means that you should leave the corresponding check box clear so that the base property will not be overridden.
</p>

<p>
	Create a group named <b>Enable vibration if supported by device</b> and set its weight to <b>120</b>.
	Apply the following filter.
	
	<pre>
		#cp.videoSupport == true && #sp.videoSubscription == true
	</pre>
	
	Apply the following configuration.
	
	<pre>
		{
		  "audioSubscriptionActive" : unchanged,
		  "videoSubscriptionActive" : unchanged,
		  "vibroSubscriptionActive" : true
		}

	</pre>
</p>

<p>
	Create a group named <b>Enable video if supported by device</b> and set its weight to <b>130</b>.
	Apply the following filter.
	
	<pre>
		#cp.vibroSupport == true && #sp.vibroSubscription == true
	</pre>
	
	Apply the following configuration.
	
	<pre>
		{
		  "audioSubscriptionActive" : unchanged,
		  "videoSubscriptionActive" : true,
		  "vibroSubscriptionActive" : unchanged
		}

	</pre>
</p>

<p>
	Now your list of endpoint groups should look like this.
	
		<br />
		<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_15.png" />
		<br />
		<br />
	
</p>

<p>
	Let's enable vibration signal for endpoint #0.
	
	To do this:
	<ol>
		<li>
			Open the <b>Endpoint profiles</b> page of the application.
			
			<br />
			<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_16.png" />
			<br />
			<br />
						
		</li>
		<li>
			See your console output to see which <b>Key hash</b> corresponds to the endpoint #0 and select it from the list.
			The <b>Endpoint profile details</b> page will open.
						
			<br />
			<img src="https://raw.github.com/hunch7/sample-apps/app-231-EpGroup-bundle/profilingdemo/resources/pic/profiling_demo_17.png" />
			<br />
			<br />
						
		</li>
		<li>
			In the <b>Server-side EP profile</b> section, click <b>Edit</b> and select the appropriate schema version (version <b>1</b> in this case).
			Then select the <b>vibroSubscription</b> check box and click <b>Save</b> to apply changes.
		</li>
	</ol>
	
	The console will display the following messages.
	
	<pre>
		2016-08-15 13:11:58,386 [pool-4-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 0-th endpoint had been updated.
		2016-08-15 13:11:58,387 [pool-4-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - Vbm/biBNcKTNSplA5qaPkBhRyTU=
		2016-08-15 13:11:58,387 [pool-4-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - Client EP - audioSupport: false, videoSupport: false, vibroSupport: true
		2016-08-15 13:11:58,387 [pool-4-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 0-th endpoint configuration: audio: false, video: false, vibration: true.
	</pre>
	
	This means that the configuration of endpoint #0 changed and now it can produce vibration signal.
</p>

<h2>Manage groups based on both client- and sever-side profile filters</h2>

You can create filters with conditions that apply to both client- and server-side of the EP profiles.

<p>
	As an example, you can create a group whose member endpoints will stop supporting vibration signal, if they have video and audio signals supported and enabled.
	Set the weight of this group to <b>140</b> and apply the following filter conditions.
	
	<pre>
		#cp.audioSupport == true && #sp.audioSubscription == true &&
		#cp.videoSupport == true && #sp.videoSubscription == true 
	</pre>
	
	Apply the following configuration.
	
	<pre>
		{
		  "audioSubscriptionActive" : unchanged,
		  "videoSubscriptionActive" : unchanged,
		  "vibroSubscriptionActive" : false
		}
	</pre>
	
	The console will display the following messages.
	
	<pre>
		...
		2016-08-15 13:13:17,372 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - The configuration for the 2-th endpoint had been updated.
		2016-08-15 13:13:17,373 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - KeyHash   - FbeamiaBVnuvCorEbw3mVjSD6NI=
		2016-08-15 13:13:17,373 [pool-16-thread-1] INFO  o.k.k.d.c.ConfigurationDemo - 2-th endpoint configuration: audio: true, video: true, vibration: false.
	</pre>
	
	This means that the configuration of endpoint #2 changed and now it cannot produce vibration signal.
</p>

<h1>Troubleshooting</h1>

If you experience problems while running the demo application, see <a href="http://kaaproject.github.io/kaa/docs/Programming-guide/Debugging-and-troubleshooting/" target="_blank">Debugging and troubleshooting</a>.
            ]]>
        </details>
    </bundle>
</projectsConfig>
